# 变量聚合

## 节点概述
**核心功能**：智能合并多路分支的输出，为下游节点提供一个统一、可靠的变量引用，简化工作流设计，避免因分支未执行而导致的空值错误。

**一句话总结**：当你的工作流存在“多选一”的分支时，用这个节点来统一收集结果，无论哪个分支被执行，下游都能用同一个变量名拿到最终结果。



## 配置指南

配置变量聚合节点主要分为三个步骤：**定义分组 -> 选择变量 -> 设定策略**。
##### 创建聚合分组
分组是聚合的基本单位，**每个分组最终会生成一个独立的输出变量**。
*   **默认分组**：节点创建后，会自动提供一个默认分组 `Group 1`。
*   **添加分组**：如果需要聚合多个不同类型的变量（例如，每个分支都输出了一个`String`类型和一个`File`类型），你可以点击“**新增分组**”按钮，创建多个分组，分别用于聚合不同类型的变量。

**核心规则**：**同一个分组内的所有变量，其数据类型必须完全相同**。例如，不能将`String`类型和`Integer`类型的变量放在同一个分组内。



##### 选择聚合变量

在每个分组中，你需要从上游分支的输出变量列表中，选择需要参与聚合的变量。
* **支持的数据类型**：节点支持聚合所有主流数据类型，包括：
  * **字符串（String）**
  
  * **数字 (Integer, Number)**
  
  * **布尔值（Boolean）**
  
  * **时间（Time）**

  * **对象（Object）**
  
  * **数组（Array）**
  
  * **文件（File）**
  
    
  

##### 设定聚合策略
策略决定了如何从分组内的多个变量中生成最终的输出值。
*   **当前策略**：目前系统支持唯一策略——**“返回每个分组中第一个非空的值” **。
*   **工作原理**：系统会按照你在分组中**排列的变量顺序**，从上到下依次检查，一旦发现某个变量的值不为空，就立即将其作为该分组的输出结果，并停止检查后续变量。
*   **调整顺序**：你可以通过**拖拽**变量列表中的项目，来调整变量的优先级。**排在前面的变量拥有更高的优先级**。
**配置示例：**
假设在 `Group 1` 中，你按以下顺序添加了三个变量：
1.  `high_priority_result`
2.  `default_result`
3.  `fallback_result`
其运行逻辑如下：
*   如果 `high_priority_result` 有值，则 `Group 1` 的输出就是 `high_priority_result` 的值。
*   如果 `high_priority_result` 为空，则检查 `default_result`。如果 `default_result` 有值，则 `Group 1` 的输出就是 `default_result` 的值。
*   只有当 `high_priority_result` 和 `default_result` 都为空时，`Group 1` 的输出才会是 `fallback_result` 的值。



## 典型应用场景

**智能客服意图分流**
假设你的工作流通过一个“意图识别”节点，将用户咨询分流到“售前咨询”、“售后服务”和“投诉建议”三个分支。每个分支都会处理并输出一个名为`reply_text`的回复内容。

*   **未使用聚合节点**：
    *   如果用户触发“售前咨询”，那么“售后服务”和“投诉建议”分支的`reply_text`都为空。
    *   下游的“发送消息”节点，必须通过复杂的条件判断（如检查`intent_type`）来决定引用哪个`reply_text`，配置繁琐且容易出错。
*   **使用变量聚合节点**：
    1.  将三个分支的`reply_text`输出，全部连接到变量聚合节点的输入。
    2.  在聚合节点中，将这三个`reply_text`配置为一个分组Group1。
    3.  下游的“发送消息”节点，直接引用分组内容即可。
    4.  **工作流执行时**：无论哪个分支被触发，其`reply_text`都会被聚合节点捕获并赋值给Group1，而未运行分支的空值则被自动忽略。下游节点始终能拿到一个有效的、非空的回复内容。

![image-20250820171519990](assets/image-20250820171519990.png)
