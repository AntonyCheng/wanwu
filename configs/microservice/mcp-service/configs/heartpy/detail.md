# 心电信号分析 - 心率变异性检测和质量评估服务

## 📋 服务信息

**服务名称**: 心电信号分析 - 心率变异性检测和质量评估服务

**基于项目**: HeartPy

**简短描述**: 基于 HeartPy 的专业心电信号分析服务。支持 PPG、ECG、BVP 等多种生理信号格式，可进行心率变异性(HRV)分析、信号质量评估和心率检测。提供时域、频域、非线性等多类别HRV指标计算，包含自动峰值检测、信号预处理、质量控制等功能。适用于医疗健康监测、运动生理评估、压力检测等应用场景。

**部署URL**: http://localhost:8100/sse

---

## 🚀 快速启动

### 安装依赖
```bash
pip install heartpy numpy fastmcp
```

### 启动服务
```bash
python heartpy_mcp_sse.py
```

### 运行测试
```bash
python test_heartpy_mcp_sse.py
```

---

## 🔧 Cursor MCP 配置

在 `.cursor/mcp_settings.json` 中添加：

```json
{
  "mcpServers": {
    "heartpy_server": {
      "type": "sse",
      "url": "http://localhost:8100/sse",
      "timeout": 600
    }
  }
}
```

---

## 🎯 核心功能

- **HRV 信号分析**: 全自动PPG/ECG/BVP信号心率变异性分析
- **多指标计算**: 时域、频域、非线性等30+种HRV指标
- **信号质量评估**: 智能信号质量检测和改进建议
- **测试信号生成**: 可配置参数的模拟心电信号生成
- **峰值检测**: 自动心跳峰值识别和异常值处理
- **数据预处理**: 信号滤波、去噪、标准化处理

---

## 💡 使用示例

```
@heartpy_server 分析这个PPG信号的心率变异性
@heartpy_server 评估这段ECG信号的质量如何
@heartpy_server 获取所有支持的HRV指标列表
@heartpy_server 生成一个心率72BPM的30秒测试信号
@heartpy_server 计算这个心电信号的RMSSD和SDNN指标
```

---

## 💓 支持的HRV指标

| 类别 | 指标 | 描述 |
|-----|------|------|
| **时域指标** | BPM, SDNN, RMSSD, PNN50 | 心率、NN间期标准差、连续差值均方根 |
| **频域指标** | LF, HF, LF/HF | 低频、高频功率、低高频比 |
| **非线性指标** | SD1, SD2, Poincaré | 庞加莱图分析、非线性动力学 |
| **其他指标** | 呼吸频率, IBI | 呼吸检测、心跳间期分析 |

---

## 📊 技术特性

- **多信号支持**: PPG (光电容积脉搏)、ECG (心电图)、BVP (血容量脉搏)
- **智能处理**: 自动峰值检测、异常值剔除、信号预处理
- **质量控制**: 信号长度检查、变异性评估、异常值检测
- **高精度分析**: 基于HeartPy科学计算库，算法经过验证
- **实时处理**: 支持实时信号分析，响应快速
- **参数可调**: 采样率、滤波参数、分析窗口可自定义

---

## 🔧 工具函数

| 函数名 | 功能描述 |
|--------|----------|
| `analyze_ppg` | PPG/ECG/BVP 信号 HRV 分析 |
| `list_supported_metrics` | 获取支持的 HRV 指标列表 |
| `get_signal_quality_info` | 信号质量评估和建议 |
| `generate_test_signal` | 生成测试心电信号 |

---

## 📈 信号要求

```python
# 推荐参数
{
    "最小时长": "5秒 (推荐30秒以上)",
    "采样率": "100Hz (范围: 10-10000Hz)",
    "信号格式": "浮点数列表",
    "数据质量": "稳定记录，无严重伪迹"
}
```

---

## 📋 分析输出

| 输出项 | 描述 | 示例值 |
|--------|------|--------|
| **BPM** | 平均心率 | 72.5 |
| **SDNN** | NN间期标准差 | 45.2 ms |
| **RMSSD** | 连续差值均方根 | 38.7 ms |
| **PNN50** | 差值>50ms百分比 | 15.2% |
| **LF/HF** | 低高频功率比 | 2.1 |
| **信号质量** | 质量评分 | 85/100 |

---

## ⚠️ 注意事项

1. 建议信号长度至少30秒以获得可靠的HRV分析
2. 采样率推荐100Hz，过低可能影响精度
3. 信号应保持稳定记录条件，避免运动伪迹
4. 分析前会自动进行信号质量检查和预处理
5. 异常值会被自动识别和处理
6. 结果解释需结合临床背景和专业知识

---

## 🎯 应用场景

- **医疗健康**: 心律不齐检测、心血管风险评估
- **运动科学**: 训练强度监控、恢复状态评估
- **压力监测**: 自主神经活动评估、压力水平检测
- **睡眠研究**: 睡眠质量分析、生理节律研究
- **康复医学**: 心脏康复监控、治疗效果评估
- **可穿戴设备**: 智能手表、健康监测设备数据分析
- **科学研究**: 生理信号研究、HRV相关实验

---

## 🔬 技术原理

1. **信号预处理**: 滤波去噪、基线校正、归一化
2. **峰值检测**: 自适应阈值法检测R波或脉搏峰
3. **RR间期提取**: 计算连续心跳间的时间间隔
4. **HRV计算**: 基于RR间期序列计算各类HRV指标
5. **质量控制**: 异常值检测、信号质量评分
6. **结果输出**: 标准化格式输出分析结果

---

## 📚 HRV指标详解

- **时域分析**: 反映心率变异的时间特征
- **频域分析**: 反映自主神经系统活动
- **非线性分析**: 揭示心率动力学复杂性
- **Poincaré分析**: 可视化RR间期变化模式