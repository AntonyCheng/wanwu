# 专业生物信号处理 - ECG/EMG时域频域分析服务

## 📋 服务信息

**服务名称**: 专业生物信号处理 - ECG/EMG时域频域分析服务

**基于项目**: BioSPPy

**简短描述**: 基于 BioSPPy 的专业生物信号处理服务，专注于 ECG（心电图）和 EMG（肌电图）的深度时域/频域分析。提供完整的心电图 R 峰检测、心率变异性计算、肌电图激活检测、频谱分析等功能。支持多种时域指标（SDNN、RMSSD、pNN50等）和频域指标（LF、HF、中值频率等）计算，适用于心脏功能评估、肌肉疲劳检测、运动生理分析等专业应用场景。

**部署URL**: http://localhost:8300/sse

---

## 🚀 快速启动

### 安装依赖
```bash
pip install biosppy numpy scipy fastmcp
```

### 启动服务
```bash
python biosppy_mcp_sse.py
```

### 运行测试
```bash
python test_biosppy_mcp_sse.py
```

---

## 🔧 Cursor MCP 配置

在 `.cursor/mcp_settings.json` 中添加：

```json
{
  "mcpServers": {
    "biosppy_server": {
      "type": "sse",
      "url": "http://localhost:8300/sse",
      "timeout": 600
    }
  }
}
```

---

## 🎯 核心功能

- **ECG 深度分析**: 完整心电图处理，R峰检测，心跳模板提取
- **ECG 特征提取**: 时域/频域 HRV 指标，心率变异性综合分析
- **EMG 专业分析**: 肌电图处理，肌肉激活检测，包络信号提取
- **EMG 特征计算**: 时域/频域特征，肌肉疲劳评估指标
- **时域分析专家**: SDNN、RMSSD、pNN50等专业HRV时域指标
- **频域分析专家**: LF/HF功率、频率分布、频谱特征分析
- **信号质量控制**: 专业信号质量评估，干扰检测，质量优化建议
- **测试信号生成**: ECG/EMG模拟信号生成，参数可调

---

## 💡 使用示例

```
@biosppy_server 分析这个ECG信号的R峰和心率变异性
@biosppy_server 提取这个EMG信号的时域和频域特征
@biosppy_server 计算这个心电信号的SDNN和RMSSD指标
@biosppy_server 分析这个肌电信号的肌肉激活模式
@biosppy_server 评估这个生物信号的质量和干扰情况
@biosppy_server 生成一个心率72BPM的ECG测试信号
```

---

## 🫀 专业分析指标

### ECG 时域指标
| 指标 | 描述 | 临床意义 |
|-----|------|----------|
| **SDNN** | NN间期标准差 | 整体心率变异性 |
| **RMSSD** | 连续差值均方根 | 短期变异性，副交感活动 |
| **pNN20/pNN50** | 差值>20/50ms百分比 | 副交感神经张力 |
| **CV_NN** | NN间期变异系数 | 标准化变异性指标 |

### ECG 频域指标
| 指标 | 频段 | 生理意义 |
|-----|------|----------|
| **VLF** | 0.003-0.04 Hz | 体温调节、血管张力 |
| **LF** | 0.04-0.15 Hz | 交感+副交感活动 |
| **HF** | 0.15-0.4 Hz | 副交感活动（呼吸性窦律不齐） |
| **LF/HF** | 比值 | 交感/副交感平衡 |

### EMG 时域指标
| 指标 | 描述 | 应用场景 |
|-----|------|----------|
| **MAV** | 平均绝对值 | 肌肉激活强度 |
| **RMS** | 均方根 | 肌肉活动水平 |
| **ZC** | 零穿越率 | 信号频率特征 |
| **SSC** | 斜率符号变化 | 肌肉收缩复杂性 |
| **WAMP** | 威尔逊幅度 | 肌肉激活变化 |

### EMG 频域指标
| 指标 | 频段 | 疲劳评估 |
|-----|------|----------|
| **MDF** | 中值频率 | 疲劳时向低频偏移 |
| **MPF** | 平均频率 | 频谱重心变化 |
| **低频功率** | 10-60 Hz | 低频肌肉活动 |
| **高频功率** | 150-300 Hz | 高频肌肉活动 |

---

## 📊 技术特性

- **专业算法**: 基于BioSPPy科学计算库，算法经过验证
- **深度分析**: 专注时域/频域的详细特征提取
- **心跳模板**: 自动心跳模板提取和分类
- **肌肉激活**: 精确肌肉激活起始点检测
- **质量控制**: 工频干扰检测、信号饱和检查
- **标准兼容**: 符合国际HRV分析标准
- **高精度处理**: 支持高采样率信号处理

---

## 🔧 工具函数

| 函数名 | 功能描述 | 专业特色 |
|--------|----------|----------|
| `analyze_ecg` | 完整ECG分析和R峰检测 | 心跳模板提取 |
| `extract_ecg_features` | ECG时域/频域特征提取 | HRV全指标计算 |
| `ecg_time_domain` | 专门ECG时域指标分析 | 专业HRV时域 |
| `analyze_emg` | 完整EMG分析和激活检测 | 肌肉激活模式 |
| `extract_emg_features` | EMG时域/频域特征提取 | 疲劳检测指标 |
| `emg_time_domain` | 专门EMG时域指标分析 | 15种时域特征 |
| `list_supported_metrics` | 获取支持的分析指标 | 指标详细说明 |
| `generate_test_signal` | 生成ECG/EMG测试信号 | 参数可调 |
| `signal_quality_assessment` | 信号质量评估 | 干扰检测 |

---

## 📈 分析输出示例

### ECG 分析结果
```json
{
  "time_domain_metrics": {
    "mean_nn": 857.2,      // 平均NN间期 (ms)
    "sdnn": 45.8,          // SDNN (ms)
    "rmssd": 38.2,         // RMSSD (ms)
    "pnn50": 15.6          // pNN50 (%)
  },
  "frequency_domain": {
    "lf_power": 1247.3,    // LF功率 (ms²)
    "hf_power": 583.7,     // HF功率 (ms²)
    "lf_hf_ratio": 2.14    // LF/HF比值
  }
}
```

### EMG 分析结果
```json
{
  "time_domain_metrics": {
    "rms": 0.125,              // 均方根
    "mav": 0.098,              // 平均绝对值
    "zero_crossing_rate": 85.2, // 零穿越率
    "wamp": 342                // 威尔逊幅度
  },
  "frequency_domain": {
    "median_frequency": 95.6,   // 中值频率 (Hz)
    "mean_frequency": 112.3     // 平均频率 (Hz)
  }
}
```

---

## ⚠️ 注意事项

1. **采样率要求**: ECG推荐250-1000Hz，EMG推荐1000-2000Hz
2. **信号长度**: ECG至少5秒（HRV需30秒+），EMG至少2秒
3. **质量控制**: 自动检测工频干扰、信号饱和、异常值
4. **滤波处理**: 服务会自动进行适当的预处理和滤波
5. **模板匹配**: ECG会自动提取心跳模板进行质量评估
6. **疲劳检测**: EMG频域指标可用于肌肉疲劳评估

---

## 🎯 应用场景

- **心脏功能评估**: 心率变异性分析、心律不齐检测
- **运动生理学**: 训练强度监控、恢复状态评估
- **肌肉疲劳检测**: 运动疲劳、职业疲劳、康复评估
- **临床诊断**: 心血管疾病诊断、神经肌肉疾病评估
- **康复医学**: 心脏康复、肌肉康复进度监测
- **人体工效学**: 工作疲劳评估、人机界面优化
- **体育科学**: 运动员状态监控、训练效果评价
- **医疗设备**: 心电监护仪、肌电分析仪数据处理

---

## 🔬 技术优势

### BioSPPy 核心算法
- **R峰检测**: 多种算法可选（Pan-Tompkins、Hamilton等）
- **心跳分割**: 自动心跳模板提取和对齐
- **EMG激活**: 自适应阈值肌肉激活检测
- **滤波处理**: 专业生物信号滤波器设计

### 时域分析专业性
- **HRV标准**: 严格按照欧洲心脏学会HRV标准
- **统计稳健**: 异常值检测和处理
- **时间精度**: 高精度RR间期计算
- **多指标综合**: 15+种时域指标

### 频域分析深度
- **功率谱密度**: Welch方法功率谱估计
- **频段定义**: 标准VLF/LF/HF频段划分
- **归一化处理**: 多种功率归一化方法
- **频率跟踪**: 动态频率特征跟踪

---

## 📚 理论基础

- **心率变异性**: 反映自主神经系统调节心脏的能力
- **时域分析**: 直接分析RR间期时间序列的统计特征
- **频域分析**: 通过频谱分析揭示不同频段的生理意义
- **EMG时频**: 肌电信号时域反映激活强度，频域反映疲劳状态
- **信号处理**: 专业生物信号滤波、去噪、特征提取算法

---

## 🏆 与其他服务对比

| 特性 | BioSPPy(8300) | NeuroKit2(8200) | HeartPy(8100) |
|------|---------------|-----------------|---------------|
| 专业领域 | ECG/EMG深度分析 | 多模态生理信号 | PPG/ECG心率分析 |
| 算法特色 | 时域/频域专家 | 科学计算全面 | 心率变异专注 |
| ECG分析 | R峰+模板+HRV | 完整处理 | 心率+基础HRV |
| EMG分析 | 专业激活+疲劳 | 基础处理 | 不支持 |
| 时域指标 | 15+专业指标 | 标准指标 | 基础指标 |
| 频域分析 | VLF/LF/HF深度 | 标准频域 | 基础频域 |
| 应用场景 | 临床/运动专业 | 科研全面 | 健康监测 |